# Incident Report (Sample) - Order API 500 Errors

## Summary
2025-12-xx 21:10頃から、注文APIが断続的に500を返し、購入処理が失敗する事象を検知した。21:28に暫定対応によりエラー率は低下し、現在は監視継続中。

## Impact
- 影響：購入処理が失敗（注文完了まで到達しない）
- 対象：一部ユーザー（断続的）
- 期間：21:10〜21:28（暫定対応まで）

## Timeline（事実のみ）
- 21:10 アラート：Order API 5xx率上昇
- 21:12 ログ確認：`/orders` で500増加、DBタイムアウト痕跡あり
- 21:16 メトリクス確認：DB接続数増加、レイテンシ悪化
- 21:20 暫定対応：注文APIのリトライ設定を抑制、同時実行を制限
- 21:28 5xx率が低下、購入成功率が回復傾向

## Hypotheses & Checks
### Hypothesis 1：DB接続枯渇（コネクションプール逼迫）
- 確認：DB接続数、待機数、タイムアウト数を確認
- 結果：接続数が上限付近、タイムアウト増加を確認
- 次の判断：同時実行を抑制し、プール設定とクエリを点検する

### Hypothesis 2：特定クエリの遅延増加（スロークエリ）
- 確認：スロークエリログ、直近のデプロイ有無
- 結果：一部クエリが遅延、直近で関連変更あり（仮）
- 次の判断：該当クエリのインデックス/実行計画を確認する

## Next Actions
### 暫定（今日/明日）
- [ ] 監視強化：5xx率とDB接続のダッシュボード監視
- [ ] 影響把握：失敗率、影響時間、影響件数の概算
- [ ] 共有：ステークホルダーへ暫定状況を報告

### 恒久（今週/今月）
- [ ] 根本対策：コネクションプール設定の見直し
- [ ] 再発防止：スロークエリ改善、負荷試験の追加
- [ ] 監視改善：DB待機・タイムアウトの閾値最適化
